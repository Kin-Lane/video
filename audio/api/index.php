<?php date_default_timezone_set('America/Los_Angeles');//error_reporting(E_ALL);ini_set('display_errors', '0');require 'config.php';require '../Slim/Slim.php';require('../3scale/ThreeScaleClient.php');require_once('../client/GitHubClient.php');require_once('../parse/index.php');require '/var/www/html/system/class-amazon-s3.php';$gclient = new GitHubClient();$gclient->setCredentials($guser, $gpass);\Slim\Slim::registerAutoloader();$app = new \Slim\Slim();// Incoming Keys$request = $app->request(); $Params = $request->params();	//var_dump($_GET);if(isset($Params['appid'])){ $appid = $Params['appid']; } else { $appid = ""; }if(isset($Params['appkey'])){ $appkey = $Params['appkey']; } else { $appkey = ""; }$client = new ThreeScaleClient($three_scale_provider_key);//echo "appid: " . $appid . "<br />";//echo "appkey: " . $appkey . "<br />";if ($appid!='' && $appkey!='') 	{		// Auth the application	$response = $client->authorize($appid, $appkey);		$Plan = $response->getPlan();	//var_dump($Plan);		$usageReports = $response->getUsageReports();	$usageReport  = $usageReports[0];	$Exceeded = $usageReport->isExceeded();		//var_dump($response);	// Check the response type	if ($response->isSuccess()) 		{				$route = '/';		$app->get($route, function ()  use ($app){		    			$E = array();														$E['Message'] = "Sorry, you do not have access!";						$app->response()->status(403);				$app->response()->header("Content-Type", "application/json");			echo format_json(json_encode($E));										});				// All fine, proceeed & pull the usage reports		$usageReports = $response->getUsageReports();				//echo "Success:";		//echo "  Plan: " .          $response->getPlan();		//echo "  Usage reports: " . var_export($usageReports, true);			// Core Instance		include "methods/instance.php";					// Utility		include "methods/utility.php";							$app->run();					// Report some usages		$response = $client->report(			array(			  array('app_id' => $appid, 'usage' => array('screen-capture' => 1))			)		);					} 	else 		{					// Something's wrong with this app.		//echo "Error: " . $response->getErrorMessage();				// I want to continue crafting my own messages!		$Message = "";		if($Exceeded==1)			{					$Message = "Sorry you have exceeded your usage limit!";							}		else			{					$Message = "Sorry, you do not have access to this API!";				}							// root		$route = '/';		$app->get($route, function ()  use ($app,$Message){		    			$E = array();														$E['Message'] = $Message;					$app->response()->status(403);				$app->response()->header("Content-Type", "application/json");			echo format_json(json_encode($E));										});						$route = '/blog/';		$app->get($route, function ()  use ($app,$Message){		    			$E = array();														$E['Message'] = $Message;					$app->response()->status(403);				$app->response()->header("Content-Type", "application/json");			echo format_json(json_encode($E));										});										$app->run();					}	} else 		{	$Message = "";	$Message = "Sorry, you do not have access to this API!!!";					// root	$route = '/';	$app->get($route, function ()  use ($app,$Message){	    		$E = array();													$E['Message'] = $Message;			$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));								});				$route = '/blog/';	$app->get($route, function ()  use ($app,$Message){	    		$E = array();													$E['Message'] = $Message;			$app->response()->status(403);			$app->response()->header("Content-Type", "application/json");		echo format_json(json_encode($E));								});								$app->run();		}?>